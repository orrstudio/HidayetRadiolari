# My App Comments

## Версия Python 3.9.16

> Выбор версии 3.9.16 обусловлен оптимизацией для проекта интернет-телевидения  
>  
> Ключевые преимущества:  
> - Улучшенная работа с сетевыми потоками  
> - Оптимизация медиа-обработки  
> - Повышенная энергоэффективность  
> - Лучшая совместимость с библиотеками  
> И несколькими ключевыми факторами описанными ниже:  
>  

1. Стабильность и зрелость:
   - Python 3.9.7 - стабильный релиз
   - Большинство критических багов уже исправлены
   - Достаточно долго на рынке, чтобы иметь хорошую поддержку
2. Совместимость:
   - Оптимальная совместимость с:
     - Kivy
     - FFmpeg
     - FFpyplayer
     - Библиотеками для сетевых операций
     - Инструментами Android-разработки
3. Производительность:
   - Улучшенный сборщик мусора
   - Оптимизации в работе словарей
   - Быстрые операции с типами данных
4. Технические преимущества Python 3.9:
    - Новые типы словарей
    - Улучшенный парсер
    - Оптимизация памяти
    - Поддержка операторов объединения (|)
5. Совместимость с Android:
    - Хорошо поддерживается python-for-android
    - Работает стабильно на мобильных устройствах

## Kivy 2.3.0
- Последняя стабильная версия
- Полная совместимость с Python 3.9.16
- Оптимизация производительности

## KivyMD 1.2.0
- Стабильная реализация Material Design
- Совместимость с Kivy 2.3.0

## Requests 2.32.3
- Современная версия для сетевых запросов
- Полная поддержка Python 3.9.x

## Pyjnius 1.5.0
- Стабильная интеграция с Android
- Эффективный доступ к Java-API

## Cython 3.0.5
- Оптимизация производительности
- Совместимость с Python 3.9

## FFpyplayer 3.2
- Стабильная версия для медиа-обработки
- Оптимизация под мобильные устройства

## Python-for-Android 2023.9.16
- Последняя стабильная версия
- Поддержка Python 3.9.x
- Современные инструменты сборки

## Android SDK и NDK

### Android SDK 30 (Android 11)
- Оптимальная совместимость с ТВ-приложениями
- Стабильная поддержка медиа-библиотек
- Широкий охват устройств
- Баланс между функциональностью и ограничениями

### Android minSdkVersion 23 (Android 6.0)
- Оптимальная минимальная версия
- Улучшенная система разрешений
- Поддержка современных медиа-функций
- Хорошая производительность
- Достаточный охват устройств

### Android NDK r27c
- Стабильная версия для компиляции
- Хорошая совместимость с Python и Kivy
- Оптимизированная сборка под мобильные устройства

### Дополнительные настройки Android

#### API и SDK
- android.api = 30 (Android 11)
- android.minapi = 23 (Android 6.0)
- android.sdk_build_tools_version = 30.0.3

#### Архитектуры
- arm64-v8a: Современные 64-битные устройства
- armeabi-v7a: Поддержка старых устройств

#### Лицензии
- Автоматическое принятие лицензий SDK и NDK
- Необходимо для автоматической сборки

### Java и Gradle настройки

#### ExoPlayer 2.19.2
- Современный медиаплеер от Google
- Преимущества:
  - Оптимизированное воспроизведение аудио
  - Поддержка потокового вещания
  - Интеграция с Android MediaSession
  - Совместим с API 23-30

#### AndroidX
- Включен (android.enable_androidx = True)
- Обеспечивает:
  - Современные компоненты Android
  - Улучшенную производительность
  - Совместимость с новыми версиями Android
  - Поддержку всех наших библиотек

#### Проверка совместимости
- ExoPlayer 2.19.2 ✅ API 23-30
- AndroidX ✅ API 23+
- Kivy 2.3.0 ✅ Поддерживает
- KivyMD 1.2.0 ✅ Поддерживает
- Python-for-android ✅ Полная поддержка

### Gradle настройки:
```ini
android.gradle_version = 7.3.3
android.gradle_plugin = 7.0.4
```

#### Почему Gradle 7.3.3:
- ✅ Совместимость с Java 11
- ✅ Поддержка Android Gradle Plugin 7.0.4
- ✅ Оптимальная работа с NDK 27.2.12479018
- ✅ Стабильная сборка для Android SDK 30
- ✅ Хорошая производительность

#### Важные замечания:
1. Gradle будет автоматически загружен buildozer
2. Версия плагина 7.0.4 оптимальна для ExoPlayer 2.19.2
3. Эта версия обеспечивает быструю инкрементную сборку

### Настройка Java для Android сборки:
```bash
# Установка OpenJDK 11
yay -S jdk11-openjdk

# Проверка версии
java -version  # Должно показать openjdk version "11.0.21"

# Установка как системной Java
sudo archlinux-java set java-11-openjdk
```

### Почему OpenJDK 11:
- ✅ Полностью совместим с Android SDK 30 и NDK 27.2.12479018
- ✅ Стабильная версия 11.0.21
- ✅ Отличная поддержка в Arch Linux
- ✅ Регулярные обновления безопасности
- ✅ Оптимальная работа с Gradle

### Настройки в buildozer.spec:
```ini
android.java_version = 11
android.java_home = /usr/lib/jvm/java-11-openjdk
```

### Важные замечания:
1. Java должна быть установлена в системе до запуска buildozer
2. Путь /usr/lib/jvm/java-11-openjdk специфичен для Arch Linux
3. При обновлении Java через pacman может потребоваться повторная установка как системной

### Python-for-Android (p4a)

Не используем специальные настройки p4a в buildozer.spec:
- p4a.branch
- p4a.source_dir

Причины:
1. Используем стабильную версию из requirements: python-for-android==2023.9.16
2. Позволяем Buildozer автоматически управлять:
   - Выбором версии
   - Путями установки
   - Конфигурацией сборки

Это обеспечивает:
- Стабильность сборки
- Отсутствие конфликтов
- Правильное управление зависимостями

### Совместимость версий Android

#### SDK 30 (Android 11) + minSDK 23 (Android 6.0)
- Полностью совместимы
- Стандартная практика: разница в 4-5 версий между target и min SDK
- Позволяет использовать новые API, сохраняя поддержку старых устройств

#### NDK 27.2.12479018 + SDK 30
- Оптимальная пара версий
- NDK 27.2.12479018 специально оптимизирован для работы с SDK 28-30
- Стабильная компиляция нативного кода

#### Совместимость с библиотеками проекта
- Python 3.9.16 - полная поддержка
- Kivy 2.3.0 - протестировано на этих версиях
- FFmpeg/FFpyplayer - работают корректно

# Команды для ввода в ручную

## Управление виртуальным окружением Python 3.9.16:
```bash
# Создание
python -m venv venv

# Активация
source venv/bin/activate

# Деактивация
deactivate
```

## Установка зависимостей:
```bash
# Обновление pip
python -m pip install --upgrade pip

# Установка всех зависимостей из requirements.txt
pip install -r requirements.txt

# Установка buildozer и Cython (если требуется отдельно)
pip install buildozer==1.5.0 Cython==3.0.5
```

## Сборка Android приложения:
```bash
# Инициализация buildozer (только при первом использовании)
buildozer init

# Очистка сборки
buildozer android clean

# Сборка debug-версии
buildozer -v android debug
```

## Отладка Android приложения:
```bash
# Просмотр логов Python
adb logcat | grep python

# Просмотр ошибок
adb logcat | grep error

# Просмотр всех логов приложения
adb logcat | grep "python\|error\|Exception"
```

## Зависимости системы Arch Linux:
```bash
# Проверка установки buildozer
pacman -Qs buildozer

# Установка системных зависимостей (если требуется)
yay -S python-pip python-virtualenv python-kivy python-setuptools
```
